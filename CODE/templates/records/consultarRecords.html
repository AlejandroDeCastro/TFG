{% extends './layout.html' %}

{% block title %}Consulta{% endblock %}

{% block head %}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

<script>
    function obtenerOpcionesSeleccionadas() {
        var opcionesSeleccionadas = [];
        var select = document.getElementById("registros");
        for (var i = 0; i < select.options.length; i++) {
            if (select.options[i].selected) {
                opcionesSeleccionadas.push(select.options[i].value);
            }
        }
        // Convierte la lista a una cadena y enviarla al servidor Flask
        var data = opcionesSeleccionadas.join(',');
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/obtener_opciones', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send('registros=' + data);
    }
</script>

{% endblock %}

{% block navbar %}
<nav>
    <label class="logo">SmartCities</label>
    <input type="checkbox" id="check">
    <label for="check" class="checkbtn">
        <i class="fa fa-bars"></i>
    </label>
    <ul>
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a href="{{ url_for('añadirConjuntos') }}">Añadir conjunto</a></li>
        <li><a href="{{ url_for('editarRecords') }}">Consultar Registros</a></li>
        <li><a>Sobre nosotros</a></li>
        <li><a class="logout" href="{{ url_for('logout') }}">Cerrar sesión</a></li>
    </ul>
</nav>
{% endblock %}

{% block body %}

<h2>Selecciona los registros a descargar:</h2>
<form id="formulario">
    <select id="registros" class="form-control custom-select" multiple>
        {% for ciudad, caracteristicas in registros.items() %}
        {% for caracteristica in caracteristicas %}
        {% for formato in registros[ciudad][caracteristica] %}
        {% for periodicidad in registros[ciudad][caracteristica][formato] %}
        <option value="{{ ciudad }} - {{ caracteristica }} - {{ formato }} - {{ periodicidad }}">{{ ciudad }} - {{ caracteristica }} - Formato: {{ formato }} - Periodicidad: {{ periodicidad }} segundos</option>
        {% endfor %}
        {% endfor %}
        {% endfor %}
        {% endfor %}
    </select>
    <br><br>
    <button type="button" onclick="obtenerOpcionesSeleccionadas()">Descargar</button>
</form>
<div id="resultado"></div>

{% endblock %}
