{% extends './layout.html' %}

{% block title %}{{opcionElegida}}{% endblock %}

{% block head %}

<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />


<base target="_top">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>{{ciudad}} - {{opcionElegida}}</title>

<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico">
<style>
    /* Estilo personalizado para centrar el h1 */
    .centrar-h1 {
        display: flex;
        width:100%;
        justify-content: center;
        align-items: center;
    }
</style>
<meta name="csrf-token" content="{{ csrf_token() }}">

{% endblock %}

{% block navbar %}
<nav>
    <label class="logo">SmartCities - {{ciudad}} - {{opcionElegida}}</label>
    <input type="checkbox" id="check">
    <label for="check" class="checkbtn">
        <i class="fa fa-bars"></i>
    </label>
    <ul>
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a href="{{ url_for('mostrarConjuntos') }}">Conjuntos</a></li>
        <li><a href="{{ url_for('editarRecords') }}">Registros</a></li>
        <li><a class="col-sm-12 col-md-4 col-lg-4" href="{{ url_for('mostrarAyuda') }}">Ayuda</a></li>
        <li><a class="logout col-sm-12 col-md-4 col-lg-4" href="{{ url_for('logout') }}">Cerrar sesión</a></li>
    </ul>
</nav>

{% endblock %}

{% block body %}
<div class="centrar-h1">
    <h1>{{ opcionElegida }} de {{ ciudad }}</h1>
</div>

<!--TABLA-->
<div class="contenedor-tabla-sin-mapa">
    <table id="tablaConOrdenación" class="table table-dark table-striped table-bordered tabla">

        <thead>
            <tr class="table-primary">
                {% for característica in listaCaracteristicas %}
                <th class="table-primary cabeceros sortable" onclick=sortTable({{loop.index0}})>{{ característica }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for conjunto in data %}
            <tr class="table-primary">
                {% for característica, dato in conjunto.items() %}
                <td class="table-primary">{{ dato }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Icono de favorito -->
<div style="text-align: center;">
    <i id="favoritoIcon" class="favorito-icon fas {% if favorito %}fa-heart favorito{% else %}fa-heart{% endif %}"></i>
    {% if ciudad == "Burgos" and opcionElegida == "Parkings" %}
    <a href="{{ url_for('mostrarGrafico') }}">
        <i class="fas fa-chart-bar"></i>
    </a>
    {% endif %}
</div>

{% endblock %}

{% block scripts %}

<script src="{{ url_for('static', filename='js/ordenación.js') }}"></script>

<script>
    // Maneja el evento de clic en el icono de favorito
    const favoritoIcon = document.getElementById('favoritoIcon');
    favoritoIcon.addEventListener('click', function() {
        const esFavorito = favoritoIcon.classList.contains('favorito');
        const url = esFavorito ? '/desmarcar_favorito' : '/marcar_favorito';
        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken  // Añadir token CSRF
            },
            body: JSON.stringify({ ciudad: "{{ ciudad }}", conjunto: "{{ opcionElegida }}" })
        }).then(response => response.json())
          .then(data => {
              if (data.success) {
                  favoritoIcon.classList.toggle('favorito', !esFavorito);
              }
          });
    });
</script>

{% endblock %}